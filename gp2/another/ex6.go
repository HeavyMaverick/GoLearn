package another

// import (
// 	"fmt"
// 	"sync"
// 	"time"
// )

// func main() {
// 	cond := sync.NewCond(&sync.Mutex{}) // Создаем условную переменную с мьютексом
// 	players := 0                        // Текущее количество подключенных игроков
// 	needed := 3                         // Необходимое количество игроков для начала игры
// 	ready := false                      // Флаг готовности игры к началу
// 	cancel := false                     // Флаг отмены игры по таймауту

// 	// Горутина для обработки таймаута
// 	go func() {
// 		time.Sleep(3 * time.Second) // Ждем 3 секунды
// 		cond.L.Lock()               // Захватываем мьютекс
// 		cancel = true               // Устанавливаем флаг отмены
// 		cond.Broadcast()            // Будим все ожидающие горутины
// 		defer cond.L.Unlock()       // Освобождаем мьютекс
// 		fmt.Println("Таймаут!")     // Сообщаем о таймауте
// 	}()

// 	// Функция подключения игрока
// 	join := func(id int) {
// 		cond.L.Lock()         // Захватываем мьютекс для работы с общими данными
// 		defer cond.L.Unlock() // Гарантируем освобождение мьютекса при выходе

// 		players++ // Увеличиваем счетчик игроков
// 		fmt.Printf("Игрок %d (%d/%d)\n", id, players, needed)

// 		// Проверяем, набралось ли нужное количество игроков
// 		if players == needed {
// 			ready = true     // Устанавливаем флаг готовности
// 			cond.Broadcast() // Будим всех ожидающих игроков
// 		}

// 		// Ждем пока игра не будет готова или не отменена
// 		// Цикл нужен для защиты от ложных пробуждений (spurious wakeups)
// 		for !ready && !cancel {
// 			fmt.Printf("Игрок %d ждет...\n", id)
// 			cond.Wait() // Освобождает мьютекс и ждет сигнала
// 			// При пробуждении мьютекс автоматически захватывается снова
// 		}

// 		// Проверяем причину выхода из ожидания
// 		if cancel {
// 			fmt.Printf("❌ Игрок %d: игра отменена\n", id)
// 		} else {
// 			fmt.Printf("✅ Игрок %d: начинаем!\n", id)
// 		}
// 	}

// 	// Подключаем 3 игроков
// 	for i := 1; i <= 3; i++ {
// 		go join(i)                  // Запускаем горутину игрока
// 		time.Sleep(1 * time.Second) // Имитируем задержку между подключениями
// 	}

// 	// Даем время для выполнения всех операций
// 	time.Sleep(4 * time.Second)
// }
